## 1、<span style="color:brown">Timer概述：</span>

**1.1、分类：**

| TIM6 | TIM7 |
| :--: | :--: |

**1.2、框图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_Timer04.png" alt="image-20251119195317218" style="zoom: 67%;" />

从内部时钟输入，会产生**3种情况的数值**，如上图所示。



## 2、<span style="color:brown">Timer配置：</span>

**2.1、Timer初始化：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_Timer05.png" alt="image-20251119195851301" style="zoom:50%;" />

- `Activated`：激活`TIM6 / TIM7`；
- `One Pulse Mode`：**产生一个脉冲信号**后，然后**计数器停止计数**；

**2.2、Counter配置：**

> TIM6、TIM7的时钟源来自**APB1总线**上的`TIMxCLK` 

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_Timer06.png" alt="image-20251119202418073" style="zoom:50%;" />

在`STM32CubeMX`中查看，频率为`72 MHz`，若<u>设置`TIM6`的**定时器频率**为`10 KHz`</u>：

- 期望值：`72 MHz / 10 KHz = 7200`；
- 实际值：`Prescaler (PSC- 16 bits value) = 7119`；✅ 

---

`STM32`基本定时器的`Counter Mode`仅有**向上计数模式**，因此选择`UP`。

---

设置**定时溢出周期时间**为`50 ms`：

- **定时器频率**为`10 KHz` (计数`10`次用时`1 ms`)；
- `50 ms`需要计数`500`次，因此：`Counter Period = 499`；✅

---

`auto-reload preload`，选择`Enable`，自动**重装载预加载值** ✅

---

`Trigger Output Parameters`选择`Reset (UG bit)` ✅

**2.3、开启Timer中断：**

`NVIC -> TIM6 global interrupt`：勾选`Enable` ✅



## 3、<span style="color:brown">功能实现：</span>

**3.1、LED闪烁：**

````c
// ================= 开启定时器 =================
"main()内"
HAL_TIM_Base_Start_IT(&htim6);
// ================= 中断服务函数 =================
"main()外"
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim){ 
	// if(htim == &htim6) {
    if(htim->Instance == TIM6) {
		HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);
	}
}
````

**3.2、定时器消抖：**

````c
// ================= 开启定时器 =================
"main()内 -> while(1)"
if(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_RESET) {
	HAL_TIM_Base_Start_IT(&htim6);
}
// ================= 中断服务函数 =================
"main()外"
void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim) {
	if(htim->Instance == TIM6) {
		HAL_TIM_Base_Stop(&htim6);
	if(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_RESET) {
		HAL_GPIO_TogglePin(LED1_GPIO_Port, LED1_Pin);
		while(HAL_GPIO_ReadPin(KEY1_GPIO_Port, KEY1_Pin) == GPIO_PIN_RESET);
	}
	}
}
````

