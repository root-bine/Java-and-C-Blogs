## 1、<span style="color:brown">组成结构：</span>

**1.1、概述：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube01.png" alt="image-20251101141915127" style="zoom:40%;" />

**单个`Digital tube`**本质上由**8个LED**组成，根据**接`GND` 或者 `VCC`**，分为<span style="color:red">共阴极、共阳极</span>：

**1.2、原理示意图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube02.png" alt="image-20251101142345942" style="zoom: 50%;" />

`LED`**两端存在电压差**，有**一定的电流**流过时，会**亮起**：

- 共**阳**极接法：`LOW_LEVEL`有效；
- 共**阴**极接法：`HIGH_LEVEL`有效（<span style="color:red">板卡采用</span>）；



## 2、<span style="color:brown">74HC245原理：</span>

**2.1、概述：**

芯片`74HC245`，是一个`8 bit`的**三态输出** - **串行**至**串行 / 并行**<span style="color:red">移位寄存器</span>。

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube05.png" alt="image-20251101151058984" style="zoom:50%;" />

**2.2、引脚说明：**

| **Symbol**                                                   | **Description**                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| <span style="color:red">**Q0, Q1, Q2, Q3, Q4, Q5, Q6, Q7**</span> | <span style="color:red">parallel data output</span>          |
| GND                                                          | ground (0 V)                                                 |
| <span style="color:red">**Q7S**</span>                       | <span style="color:red">serial data output</span>            |
| MR                                                           | master reset (**active LOW**)                                |
| <span style="color:green">**SHCP**</span>                    | <span style="color:green">shift register clock input</span>      (**移位寄存器**时钟输入) |
| <span style="color:green">**STCP**</span>                    | <span style="color:green">storage register clock input</span> (**锁存寄存器**时钟输入) |
| OE                                                           | output enable input (**active LOW**)                         |
| <span style="color:blue">**DS**</span>                       | <span style="color:blue">serial data input</span>            |
| Vcc                                                          | supply voltage                                               |

**2.3、数据传输：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube06.png" alt="image-20251101153837510" style="zoom:120%;" />

✅`DS`采用`MSB-First`传输，因此`Q0 - Q7 = bit 0 - bit 7`。



## 3、<span style="color:brown">74HC245控制：</span>

**3.1、板卡原理图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube07.png" alt="image-20251101160721875" style="zoom:45%;" />

`DS`、`STCP`、`SHCP`分别接入**`MCU`引脚**：`PC13`、`PC14`、`PC15`。

实验板卡集成**两颗`74HC245`**，用于**驱动两个数码管**：

- `74HC595_01`的`Q7S`，为`74HC595_02`的`DS`输入数据；
- `74HC595_01`只使用`Q0`、`Q1`管理**数码管地址**；
- `74HC595_02`是用于控制数码管**输出显示**；

因此，在**单一**或**多个数码管**显示时，要<u>保证<span style="color:red">**一次性**把**`data`移入**`SHCP`，然后 **一次性锁存**</span></u>。

**3.2、工程代码：**

在`STM32CubeMX`设置：1、`GPIO`引脚功能为：`GPIO_Output`；2、默认输出电平为`HIGH`；3、使用推挽输出；4、上拉电阻：

````c
//共阴 数码管数组：0-9
unsigned char num[]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F};
#define ADDR_0 0xFE
#define ADDR_1 0xFD
void hc595_send_byte(uint8_t byte) {
	for(int i=0; i<8; i++) {
		if(byte&0x80) {
			HAL_GPIO_WritePin(DS_GPIO_Port, DS_Pin, GPIO_PIN_SET);
		} else {
			HAL_GPIO_WritePin(DS_GPIO_Port, DS_Pin, GPIO_PIN_RESET);
		}
		HAL_GPIO_WritePin(SHCP_GPIO_Port, SHCP_Pin, GPIO_PIN_RESET);
		HAL_GPIO_WritePin(SHCP_GPIO_Port, SHCP_Pin, GPIO_PIN_SET);
		byte <<= 1;
	}
}
void hc595_send_data(uint8_t num, uint8_t addr) {
	hc595_send_byte(num);
	if(addr == 0) {
		hc595_send_byte(ADDR_0);
	} else if(addr == 1) {
		hc595_send_byte(ADDR_1);
	}
	HAL_GPIO_WritePin(STCP_GPIO_Port, STCP_Pin, GPIO_PIN_RESET);
	HAL_GPIO_WritePin(STCP_GPIO_Port, STCP_Pin, GPIO_PIN_SET);
}
void main(){
  while(1) {
    //在第一个数码管显示数字0
    hc595_send_data(num[0], 0);
    //在第二个数码管显示数字3
    hc595_send_data(num[3], 1);
  }
}
````