## 1、<span style="color:brown">485介绍：</span>

**1.1、概述：**

`RS-485`是一种<span style="color:green">差分式、半双工、多点总线</span>的<span style="color:red">串行通信</span>接口标准，<span style="color:purple">是一种电气标准，并非协议</span>：

|   特性   |           UART & USART           |           RS-485           |
| :------: | :------------------------------: | :------------------------: |
| 硬件线路 |           TX, RX, GND            |          A线, B线          |
| 通信拓扑 | 异步的 / 同步的、**点对点**总线❗ |   异步的、**多点**总线❗    |
| 数据传输 |      **全双工**，LSB-First❗      |   **半双工**，LSB-First❗   |
| 数据速率 |            **波特率**            | 与**UART & USART**配合使用 |

**1.2、对比：**

`RS-485`比`UART & USART`更强，原因在于：

1. **差分传输**具有很强的**抗干扰性**；
2. 能够**远距离传输**；
3. 使用`32`节点的**多点通信**；

**1.3、多机通信：**

`RS-485`具备<span style="color:red">**32节点**总线结构</span>，允许**多个设备**挂在**同一根 A/B 线**上：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_RS485_01.png" alt="image-20251127191230698" style="zoom:40%;" />

✅<span style="color:red">只能一个设备发，其他设备接收</span>，若多个设备同时发送就会**导致总线冲突**，并**产生数据错乱**。



## 2、<span style="color:brown">SP3485芯片：</span>

**2.1、场景说明：**

`STM32`**没有硬件485接口**，所以通常使用**485收发器**将<span style="color:red">`UART`的`TTL`电平</span>转换成<span style="color:red">`RS485`的差分信号</span>：

- 通过`TxD`发送数据，经**485收发器**转换成**差分信号**，传输到总线上；
- 通过`RxD`接收数据，**485收发器**将总线上的**差分信号**转化成**TTL信号**；

**2.2、引脚说明：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_RS485_02.png" alt="image-20251127200435750" style="zoom: 67%;" />

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_RS485_03.png" alt="image-20251127193016411" style="zoom:50%;" />

`DE`控制`DI -> 485_TXD`：1 发送使能，0 发送禁止。

`RE`控制`RO -> 485_RXD`：1 接收禁止，0 接收使能。

`MCU`发送数据：控制`CTRL`为`HIGH_LEVEL`，数据通过`485_TXD`**发送**出去。

`MCU`接收数据，控制`CTRL`为`LOW_LEVEL`，数据通过`485_RXD`**接收**回来。



## 3、<span style="color:brown">原理分析：</span>

**3.1、RS-485原理图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_RS485_04.png" alt="image-20251127193449335" style="zoom:35%;" />

`Q1`是**N型MOS管**:

- 当**TXD高电平**，`MOS`管导通，`RE + DE`引脚接`GND`，进入**接收模式**；

- 当**TXD低电平**，`MOS`管截止，`RE + DE`引脚接`HIGH_LEVEL`，进入**发送模式**；

**3.2、RS-485实现：**

> 连接好RS-485模块与板卡的A线、B线

`RS-485`通常与**UART & USART一起使用**，查看芯片原理图：`485_RXD -> PD2`、`485_TXD -> PC12`。

![image-20251128164729760](https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_RS485_05.png)

✅因此，`RS-485`与`USART5`搭配使用，因此配置`UART5`即可。

**3.3、工程代码：**

````c
"main.c -> 全局变量":
uint8_t rxbuf[10];
uint8_t sxbuf[] = "hello world";
"main.c -> while(1)": 
if(HAL_UART_Receive(&huart1, rxbuf, sizeof(rxbuf), 1000) == HAL_OK) {
	HAL_UART_Transmit(&huart1, sxbuf, sizeof(sxbuf), 1000);
}
HAL_Delay(500);
````

