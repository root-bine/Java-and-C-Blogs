## 1、<span style="color:brown">串口说明：</span>

**1.1、80C51的UART：**

在`80C51`中，`UART`由**四种工作模式**：

|    编号    | 名称 / 类型    | 数据位数                           | 波特率                               |
| :--------: | :------------- | ---------------------------------- | ------------------------------------ |
| **Mode_0** | 同步移位寄存器 | **8 位数据**                       | 固定波特率：`fosc/12`                |
| **Mode_1** | 异步 UART      | 10 位（1起始 + **8数据** + 1停止） | **可变波特率**（由`Timer1`产生）     |
| **Mode_2** | 异步 UART      | 11 位（1起始 + **9数据** + 1停止） | 固定波特率（`fosc/64` 或 `fosc/32`） |
| **Mode_3** | 异步 UART      | 11 位（1起始 + **9数据** + 1停止） | **可变波特率**（由`Timer1`产生）     |

**1.2、串口电平标准：**

|    Type     |        HIGH_LEVEL        |        LOW_LEVEL         |
| :---------: | :----------------------: | :----------------------: |
| `TTL`电平✅  | `+3.3 V / +5 V`，表示`1` |      `0 V`，表示`0`      |
| `RS232`电平 | `[-3 V, -15 V]`，表示`1` | `[+3 V, +15 V]`，表示`0` |
| `RS485`电平 | `[+2 V, +6 V]`，表示`1`  | `[-2 V, -6 V]`，表示`0`  |

`UART & USART`通信协议采用的是**TTL电平标准**。

**1.3、UART与USART：**

> STM32F10xxx参考手册_ch.pdf：2.1 系统架构 -> 图1 系统结构

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART01.png" alt="image-20251121171922167" style="zoom: 40%;" />

`STM32F103RC`系列芯片中，有**五个**串口：`3`个`USART` (通用**同步和异步**收发器)、`2`个`UART` (通用**异步**收发器)。

**1.4、IO说明：**

查看`STM32F103RC`芯片手册：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART02.png" alt="image-20251121172342324" style="zoom: 67%;" />

☑️**数据发送线路**：

| `TX`：发送数据`Output`引脚 | `RX`：接收数据`Input`引脚 | `SCLK`：发送器时钟`Output`引脚（仅适用于<span style="color:red">同步模式</span>） |
| :------------------------: | :-----------------------: | :----------------------------------------------------------: |

☑️**硬件流控**：如果<span style="color:red">发送设备发送太快，接收设备来不及处理</span>，可以通过**流控**来<u>控制传输的速度</u> 

| `nRTS (Request To Send)`：请求发送`Output`引脚 | 表示`MCU`自身<u>是否`Ready to Receive`</u> |
| :--------------------------------------------: | :----------------------------------------: |

| `nCTS (Clear To Send)`：清除发送`Input`引脚 | 表示`MCU`用于<u>接收对方的`nRTS`信号</u> |
| :-----------------------------------------: | :--------------------------------------: |



## 2、<span style="color:brown">串口配置：</span>

**2.1、串口模式：**

|             ✅Mode              |   Description    |
| :----------------------------: | :--------------: |
|         `Asynchronous`         |     异步通讯     |
|         `Synchronous`          |     同步通讯     |
|  `Single Wire (Half-Duplex)`   | 单线(半双工)通讯 |
| `Multiprocessor Communication` |   多处理器通信   |

|            ☑️Mode            |                         Description                          |
| :-------------------------: | :----------------------------------------------------------: |
| `SmartCard`、`IrDA` 、`LIN` | 通信协议，应用于**智能卡(IC 卡 / 银行卡)**、**红外串口**、**局域网 ** |

❌补充：在异步模式下，<u>`USART & UART`基本无差异，使用UART的库函数即可</u>，但在其他模式下**需要对应的GPIO操作函数**。

**2.2、设置串口：**

在`Pinout & Configuration`，点击`Connectivity`，<u>选择`USART / UART`的类型，并配置`Mode`与`Baud Rate`</u>：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART04.png" alt="image-20251121183916180" style="zoom: 50%;" />

这样设置`UART / USART`，`Stm32CubeMX`会<span style="color:red">自动配置对应的GPIO引脚</span>：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART05.png" alt="image-20251121184022087" style="zoom:50%;" />

**2.3、传输方式：**

> stm32f1xx_hal_uart.h
>
> `Asynchronous`下，`HAL`库对`UART & USART`统一封装为 `UART_HandleTypeDef` 

|         Function          |             Description              |
| :-----------------------: | :----------------------------------: |
|   `HAL_UART_Transmit()`   | 串口轮询模式发送（使用超时管理机制） |
|   `HAL_UART_Receive()`    | 串口轮询模式接收（使用超时管理机制） |
| `HAL_UART_Transmit_IT()`  |          串口中断模式发送✅           |
|  `HAL_UART_Receive_IT()`  |          串口中断模式接收✅           |
| `HAL_UART_Transmit_DMA()` |          串口`DMA`模式发送           |
| `HAL_UART_Receive_DMA()`  |          串口`DMA`模式接收           |

**2.4、Printf函数：**

在`MDK`中设置：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART08.png" alt="image-20251128200450103" style="zoom:67%;" />

并在工程中加入以下内容：

````c
"main.c -> main() Before"
#include <stdio.h>
"main.c -> main() After"
int fputc(int ch, FILE *f) {
    HAL_UART_Transmit(&huart1 , (uint8_t *)&ch, 1, 0xFFFF);
    return ch;
}
````
