## 1、<span style="color:brown">电机概述：</span>

**1.1、介绍：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/PWM03.png" alt="image-20251012145056792" style="zoom: 67%;" />

直流电机是指能将**直流电能**转换成**机械能**转动的设备。

**1.2、组成结构：**

直流电机的结构是由**定子**和**转子**组成：

- 直流电机运动时，不动的部分称为定子，定子的主要作用是产生磁场；

- 运行时转动的部分称为转子，其主要作用是产生电磁转矩和感应电动势；

**1.3、工作方式：**

直流电机没有正负之分，在**两端加上直流电就能工作**：

1. <span style="color:red">**交换电极可以改变电机旋转的方向**</span>；
2. <span style="color:red">**两端的压差越大，转速越快**</span>；



## 2、<span style="color:brown">原理控制：</span>

**2.1、原理图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/PWM04.png" alt="image-20251012145536874" style="zoom: 50%;" />

参照原理图：`DC_AN1 -> P2.4`、`DC_AN2 -> P2.3`。

**2.2、TC118S说明：**

`TC118S`（**单通道直流马达驱动器**）：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/PWM05.png" alt="image-20251012150011203" style="zoom: 67%;" />

**`51`单片机**起到的主要作用是<span style="color:red">**控制**</span>，而**直流电机**是<u>*大功率的器件，不能使用单片机直接驱动*</u>。



## 3、<span style="color:brown">功能实现：</span>

**3.1、控制电机正转&反转：**

```c
#include <REGX52.H>
sbit DC_AN1 = P2 ^ 4;
sbit DC_AN2 = P2 ^ 3;
void delay_ms(unsigned int xms) {
    unsigned int i, j;
    for(i=xms;i>0;i--)
    {
        for(j=124;j>0;j--)
        {}
    }
}
void main() {
	while(1) {
		DC_AN1 = 0; // 正转
		DC_AN2 = 1;
		delay_ms(2000);
		DC_AN1 = 0; // 处于同一电平, 电机停止
		DC_AN2 = 0;
		delay_ms(2000);
		DC_AN1 = 1; // 反转
		DC_AN2 = 0;
		delay_ms(2000);
		DC_AN1 = 0; // 处于同一电平, 电机停止
		DC_AN2 = 0;
		delay_ms(2000);
	}
}
```

通过操作`DC_AN1 -> P2.4`、`DC_AN2 -> P2.3`，让<span style="color:red">两个引脚存在电压差</span>，从而实现**电机转动**。

**3.2、PWM控制转速：**

```c
#include <reg52.h>
#define TIMS (65536 - 922) // 约1ms溢出
sbit dc_an2 = P2^3;
sbit dc_an1 = P2^4;
unsigned char count, duty;
void delay_ms(unsigned int xms); // 调试时, 需补充完整
void Init_Timer() {
	TMOD = 0x01;
    TL0 = TIMS;
    TH0 = TIMS >> 8;
	TR0 = 1;
    ET0 = 1;                                         
    EA  = 1;                                                    
}
void Timer0() interrupt 1 { // 1 ms触发
	TH0 = TIMS >> 8;
	TL0 = TIMS;
    count++;            // 0-100
    count %= 100;       // count = 100时, 重置为0
    if(count < duty) {  //计数值与比较值进行比较
        dc_an2 = 1;
    } else {      
        dc_an2 = 0;
    }
}
void main() { 
    Init_Timer();
    while(1){
        duty = 10;
        delay_ms(5000);
        duty = 30;
        delay_ms(5000);
        duty = 60;
        delay_ms(5000);
        duty = 90;
        delay_ms(5000);
    }
}
```

| compare |   Ton   |  Toff   |
| :-----: | :-----: | :-----: |
|  `10`   | `10 ms` | `90 ms` |
|  `60`   | `60 ms` | `40 ms` |
|  `90`   | `90 ms` | `10 ms` |
