## 1、<span style="color:brown">UART中断：</span>

**1.1、中断流程图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/UART24.png" alt="image-20251010144133438" style="zoom: 50%;" />

**1.2、中断服务程序：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/UART25.png" alt="image-20251010144224970" style="zoom:67%;" />

**1.3、问题引入：**

```c
void UartInit();
void Receive();
void main() {
    UartInit();
    while(1) {
        delay_200000ms(); //延时20s
        Receive();
    }
}
```

在main函数中，当**插入一个长延时任务**时，会导致**接收数据丢失**。



## 2、<span style="color:brown">中断应用：</span>

**2.1、触发条件：**

在<span style="color:red">接收到有效数据</span>时，会触发**串口中断**。

**2.2、案例：**

```c
#include <reg52.h>
sbit led = P2^7;
void UartInit() {            
      SCON = 0x50;            
      TMOD &= 0x0F;           
      TMOD |= 0X20;           
      TH1 = 0xFD;            
      TL1 = 0XFD;
      TR1 = 1;   
      ES  = 1; // 打开UART中断
      EA  = 1; // 打开总中断
}
void Receive() interrupt 4 {
    char receive;
    if(RI==1) {
           RI=0; 
           receive=SBUF;
           if(receive=='O')
               led=0;
           else if(receive=='C')
               led=1;        
        }
}
void delay_ms(unsigned int xms) {
    unsigned int i, j;
    for(i=xms;i>0;i--) {
        for(j=124;j>0;j--) {}
    }
}
void main() {
    UartInit();
    while(1) {
        delay_ms(20000);
    }
}
```

