## 1、<span style="color:brown">PWM：</span>

**1.1、概述：**

**PWM（Pulse-Width Modulation，脉冲宽度调制）**，本质上是一种**时间域的数字调制技术**。

一种通过**调整脉冲信号**的<span style="color:red">高电平持续时间（Ton）和低电平持续时间（Toff）的比例</span>来控制电路输出的技术。

**1.2、频率与占空比：**

<u>数学逻辑含义</u>：

| 频率（`f`） / 周期（`T`） | `f = 1 / T` | `T  = Ton + Toff` |
| :-----------------------: | :---------: | :---------------: |

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/PWM01.png" alt="image-20251012124949747" style="zoom:50%;" />

| 占空比（`Duty Cycle`，`D`） | `D = Ton / T` | 通常用百分比表示（`0% ~ 100%`） |
| :-------------------------: | :-----------: | :-----------------------------: |

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/PWM02.png" alt="image-20251012125126878" style="zoom:50%;" />

<u>物理逻辑含义</u>：

在物理实际电路中，等式`Duty = Ton / T`含义为：<span style="color:red">**有效电平**</span>占**周期**的比例。

**1.3、软件实现核心逻辑：**

```c
count++;             // 每进一次中断，就代表时间前进了一小步
if(count >= period)  // 若一轮周期结束
    count = 0;

if(count < duty)     // 高电平时间
    输出高;
else
    输出低;
```

这段逻辑能保证：

- **波形周期性稳定**；
- **占空比精准**；
- **边界干净（从 period-1 到 0）**;



## 2、<span style="color:brown">PWM 取模问题：</span>

**2.1、 LED 与 电机 的特性：**

|          项目          |         LED          |          直流电机          |
| :--------------------: | :------------------: | :------------------------: |
|        响应速度        |    极快（微秒级）    |     极慢（毫秒～秒级）     |
|      PWM 频率要求      |   ≥ 1kHz 才不会闪    |  几百 Hz 甚至几十 Hz 都可  |
| 是否能容忍周期“微抖动” | ❌ 不行（波形要平滑） | ✅ 可以（能量平均效果稳定） |

**2.2、代码分析：**

> `%` 不是<span style="color:red">纯逻辑判断</span>，而是<u>**一次操作**：<span style="color:red">除法 + 余数 + 写入</span></u>。

```c
int count = 0;  // 全局
Function: 		// 1 ms触发
	count++;
	方式1: count %= 100;
	方式2: if(count >= pwm_period) {
		   		count = 0;
		   }
```

`count = 0 ~ 100`，即：PWM周期 = `100 ms`，得出频率为`10 Hz`。

实际演示过程中：

- 在电机操控中，使用两种方式均可；
- <u>*LED不能采用**方式2***</u>；

**2.3、分析整理：**

|         项目         | 电机 PWM          | LED PWM                             |
| :------------------: | ----------------- | ----------------------------------- |
|       典型频率       | `50 Hz`～`500 Hz` | `1 kHz`～`10 kHz`                   |
|       响应速度       | 慢（ms 级）       | 快（µs 级）                         |
|       输出要求       | 平均能量稳定      | 周期时间稳定                        |
| **`Duty`抖动**敏感性 | 低                | <span style="color:red">高</span>   |
|  **周期抖动**敏感性  | 低                | <span style="color:red">极高</span> |
|    是否能用 `%=`     | ✅ 可以            | ❌ 不建议                            |

