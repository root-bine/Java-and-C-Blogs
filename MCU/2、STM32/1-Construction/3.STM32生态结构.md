## 1、<span style="color:brown">ST嵌入式软件产品定位：</span>

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_05.png" alt="image-20251109185252913" style="zoom:40%;" />

横轴是 **Portability Level（可移植性）**，纵轴是 **Abstraction Level（抽象层级）**。

- ➤ 向右：代表**代码移植性更强**（适配更多 STM32 系列）；
- ➤ 向上：代表**抽象程度更高**（离底层更远，开发更方便）；



## 2、<span style="color:brown">库体系介绍：</span>

**2.1、早期库体系（非 Cube 时代）：**❌

|      `STM32Snippets`：       |     `Standard Peripheral Library`（标准外设库）：      |
| :--------------------------: | :----------------------------------------------------: |
| 最底层的**裸寄存器示例代码** |      封装**寄存器操作函数**，但**无法跨系列使用**      |
| **完全无封装**且**效率最高** | <span style="color:red">已停止更新，被`HAL`替代</span> |

**2.2、现代 STM32Cube 软件体系：**✅

| `STM32Cube LL`（`Low_Layer APIs`）：                         | `STM32Cube HAL`（`Hardware Abstraction Layer`）：            |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 提供<span style="color:red">**轻量、接近寄存器**的 `API`</span> | `ST`官方的**硬件抽象层库**，完整**封装外设驱动**             |
| 可移植性**较强**，运行效率**最高**                           | 可移植性**强**，运行效率**略低**，但<span style="color:green">开发效率高</span> |

🛡️ `STM32Cube Middleware Level`：

- 高层软件组件，包括：`TCP/IP`、`USB`、文件系统、`RTOS`等；
- 构建在**`HAL`层**之上；



## 3、<span style="color:brown">STM32启动流程：</span>

✅**STM32 并不是直接从 main 开始执行的**：

① <u>初始化堆栈指针 `SP`</u>：

- **复位后**，**ARM Cortex-M 内核**会自动从地址 `0x0000_0000`（向量表首地址）取出**栈顶指针初值 (SP)**；

- `CPU`会自动将其加载到寄存器 **SP (Stack Pointer)**，为<span style="color:red">**程序运行提供heap、stack支持**</span>；

---

② <u>初始化程序计数器指针 `PC`</u>：

- **向量表**第二个字（地址 `0x0000_0004`）是**复位中断入口地址**；
- `MCU`会将该地址加载到 **PC（Program Counter）**，作为<span style="color:red">**程序起始执行位置**</span>；

---

③ <u>设置堆、栈的大小</u>：

- 在链接脚本（`linker.ld`）中定义`heap`与`stack`区域，由启动文件（`startup.s`）在**复位**时配置；
- 用于<span style="color:red">支持**malloc / free**、**函数调用**、**局部变量**、**ISR现场保存**等操作</span>；

---

④ <u>设置中断向量表入口地址</u>：

- `Cortex-M`内核有专门的**向量表寄存器 (VTOR)**，存放**各中断服务函数**的**入口地址**；
- 确保**中断触发**后，能正确<span style="color:red">跳转到对应`ISR`</span>（`Interrupt Service Routine`，中断服务程序/函数）；

---

⑤ <u>调用 `SystemInit()` 完成系统初始化</u>：

- `SystemInit()` 位于 `system_stm32xxxx.c` 文件，用于<span style="color:red">建立`MCU`的运行环境</span>；

---

⑥ <u>设置C库入口，跳转到`main()`</u>：

- 启动文件（`startup.s`）会调用 `_main`（也叫 `__main`），来进行<span style="color:red">C 运行时环境初始化</span>；

