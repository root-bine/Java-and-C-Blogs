## 1、<span style="color:brown">ADC电路说明：</span>

**1.1、原理图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_ADC05.png" alt="image-20251128185501555" style="zoom:67%;" />

开发板使用`PA0`做**ADC采集实验**：

- `PA0`外部接一个**滑动电阻器**，`R92`为保护电阻；
- 滑动电阻器，PA0上的电压会在`0-3.3 V`变化；

**1.2、ADC通道：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_ADC06.png" alt="image-20251128185948622" style="zoom:67%;" />

`PA0`引脚复用为`ADC123_IN0`，即：与`ADC1_IN0`、`ADC2_IN0`、`ADC3_IN0`关联。

因此，可以采集`ADC1 / ADC2 / ADC3`的**IN0的值**，来计算出**PA0的电压**。



## 2、<span style="color:brown">通用配置：</span>

**2.1、ADCs_Common_Settings：**

```bash
✅独立模式
<1> Independent mode 　　　　　　　　　　　　　　　　　　　　　ADC1 和ADC2 工作在独立模式
☑️双重模式
<2> Dual regular simultaneous + injected simultaneous mode ADC1和ADC2工作在同步规则模式和同步注入模式
<3> regular regular simultaneous + alternate trigger mode  ADC1和ADC2工作在同步规则模式和交替触发模式
<4> Dual injected simultaneous mode only 　　　　　　　　　　ADC1和ADC2工作在同步注入模式
<5> Dual regular simultaneous mode only 　　　　　　　　　　 ADC1和ADC2工作在同步规则模式
<6> Dual interleaved mode only 　　　　　　　　　　　　　　　 ADC1和ADC2工作在交叉模式
<7> Dual alternate trigger mode only 　　　　　　　　　　　　ADC1和ADC2工作在交替触发模式
```

`Mode`的选择：

- **不需要ADC同步**或者**只需要一个ADC**，应该设成**独立模式**；

- 需要**多个ADC同时使用**，应该设成**双重模式**；

**2.2、Data Alignment：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_ADC07.png" alt="image-20251128190856956" style="zoom:60%;" />

`ADC`的数据是**12位精度**，但是数据存储在**16位数据寄存器**中，所以`ADC`的存储结果分为**左对齐或右对齐**。

**2.3、Scan Conversion Mode：**

| 只使用单个通道，默认为`DISABLE` | 使用多个通道，则自动设置为`ENABLE` |
| :-----------------------------: | :--------------------------------: |

❗❗❗注意：**多通道**后，需要<span style="color:red">修改`Number of Conversion`为**对应通道数量**才生效</span>，否则<u>不能设置为`EBABLE`</u>。

**2.4、Continuous Conversion Mode：**

`ADC`**单通道**：

|                  `ENABLE`                   |            `DISABLE`            |
| :-----------------------------------------: | :-----------------------------: |
| 连续转换：使能一次`ADC`后，能够**连续转换** | 单次转换：<u>只进行一次转换</u> |

`ADC`**多通道**：

|                    `ENABLE`                    |                       `DISABLE`                        |
| :--------------------------------------------: | :----------------------------------------------------: |
| 连续转换：每个通道转换完之后，**继续循环转换** | 单次转换：<u>每个通道转换完一次</u>后，<u>结束转换</u> |

**2.5、Discontinuous Conversion Mode：**

|                      单通道                      |                       多通道                        |
| :----------------------------------------------: | :-------------------------------------------------: |
| 扫描模式为`DISABLE`，因此**间断模式**为`DISABLE` | 扫描模式为`ENABLE`，可以设置**间断模式**为`ENSABLE` |

间断模式可以把**多个通道的ADC**转换**分组**，**间断采集**。



## 3、<span style="color:brown">常规配置：</span>

**3.1、ADC Regular Conversion Mode：**

**ADC常规转换模式**中，<span style="color:red">设置**Enable Regular Conversions (启用常规转换模式)**为`ENABLE`</span>，才可以进行如下设置：

`Number OF Conversion`：

- 根据<u>使用通道数</u>，配置**转换通道数**；
- 设置为**多通道**，则自动使能`Scan Conversion Mode`；

`Extenal Trigger Conversion Source`：

|               ADC的触发方式               |              说明              |
| :---------------------------------------: | :----------------------------: |
| `Regular Conversion launched by software` | 软件触发，即：**调用函数**触发 |
|     `Timer X Capture Compare X event`     |        **外部引脚**触发        |
|        `Timer X Trigger Out event`        |     **定时器通道**输出触发     |

**3.2、Rank：**

每一个**ADC通道**，都对应一个**Rank（转换顺序）**，因此<u>采样时间</u>计算如下：
$$
Tconv = 采样时间+12.5个周期
$$
当`ADCCLK = 14 MHz`，采样时间为`1.5 Cycles` ，可得到`14 Cycles`，即最小采样时间`1 us`。

**3.3、ADC Injected ConversionMode：**

**注入通道设置**一般为`DISABLE`，因为<span style="color:red">注入通道一般使用`Extern Interrupt`、`Timer Interrupt`作为触发源</span>。

**3.4、WahchDog：**

一般可以选择<span style="color:purple">Enable Analog WatchDog Mode(使能模拟看门狗中断)</span>，用于**在意外情况下保存数据**。