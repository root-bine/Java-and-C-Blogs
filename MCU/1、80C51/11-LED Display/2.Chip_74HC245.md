## 1、<span style="color:brown">74HC245介绍：</span>

**1.1、概述：**

芯片`74HC245`，是一个`8 bit`的**三态输出** - **串行**至**串行 / 并行**<span style="color:red">移位寄存器</span>。

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube05.png" alt="image-20251101151058984" style="zoom:50%;" />

**1.2、引脚说明：**

| **Symbol**                                                   | **Description**                                              |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| <span style="color:red">**Q0, Q1, Q2, Q3, Q4, Q5, Q6, Q7**</span> | <span style="color:red">parallel data output</span>          |
| GND                                                          | ground (0 V)                                                 |
| <span style="color:red">**Q7S**</span>                       | <span style="color:red">serial data output</span>            |
| MR                                                           | master reset (**active LOW**)                                |
| <span style="color:green">**SHCP**</span>                    | <span style="color:green">shift register clock input</span>      (**移位寄存器**时钟输入) |
| <span style="color:green">**STCP**</span>                    | <span style="color:green">storage register clock input</span> (**锁存寄存器**时钟输入) |
| OE                                                           | output enable input (**active LOW**)                         |
| <span style="color:blue">**DS**</span>                       | <span style="color:blue">serial data input</span>            |
| Vcc                                                          | supply voltage                                               |

**1.3、数据传输：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube06.png" alt="image-20251101153837510" style="zoom:120%;" />

`DS`采用`MSB-First`传输，因此`Q0 - Q7 = bit 0 - bit 7`。



## 2、<span style="color:brown">控制问题：</span>IO的数量

**2.1、板卡原理图分析：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Digital_Tube07.png" alt="image-20251101160721875" style="zoom:50%;" />

`DS`、`STCP`、`SHCP`分别接入**`MCU`引脚**：`P0.3`、`P0.4`、`P0.5`。

实验板卡集成**两颗`74HC245`**，用于**驱动两个数码管**：

- `74HC595_01`的`Q7S`，为`74HC595_02`的`DS`输入数据；
- `74HC595_01`只使用`Q0`、`Q1`管理**数码管地址**；
- `74HC595_02`是用于控制数码管**输出显示**；

因此，在**单一**或**多个数码管**显示时，要<u>保证<span style="color:red">**一次性**把**`data`移入**`SHCP`，然后 **一次性锁存**</span></u>。

**2.2、工程代码：**

````c
#include <reg52.h>
sbit ds_pin = P0^3;
sbit stcp_pin = P0^4;
sbit shcp_pin = P0^5;
//共阴 数码管数组：0-9
unsigned char num[]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F};
void hc595_send_byte(unsigned char byte) {
        unsigned int i;
        for(i = 0; i < 8; i++) {
                if(byte & 0x80)
                        ds_pin = 1;
                else
                        ds_pin = 0;
                shcp_pin = 0;
                shcp_pin = 1;
                byte <<= 1;
        }
}
void hc595_send_data(unsigned char num, unsigned char addr) { // num-需要显示的内容 addr-在哪个数码管显示
        hc595_send_byte(num); //先发需要显示的数字
        if(addr == 0)
            hc595_send_byte(0xFE);  //Q0控制  0b1111 1110 0xFE 
        else if(addr == 1)    
            hc595_send_byte(0xFD);  //Q1控制  0b1111 1101 0xFD 
        stcp_pin = 0;
        stcp_pin = 1;
}
void main(){
  while(1) {
    //在第一个数码管显示数字0
    hc595_send_data(num[0], 0);
    //在第二个数码管显示数字3
    hc595_send_data(num[3], 1);
  }
}
````