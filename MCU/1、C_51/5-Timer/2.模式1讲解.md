## 1、<span style="color:brown">原理结构：</span>Timer0 -> 模式1

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Timer07.png" alt="image-20250915161019337" style="zoom:67%;" />

此模式下，`Timer0`配置为**16位定时器/计数器**，由`8 bit_TL0`和`8 bit_TH0`构成。



## 2、<span style="color:brown">时钟源：</span>

**2.1、时钟结构图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Timer08.png" alt="image-20250915163110335" style="zoom:50%;" />

**2.2、时钟源选择：**

| Timer    | Register                     | Pin         |
| -------- | ---------------------------- | ----------- |
| `Timer0` | `TMOD.2 | C/T = 0` -> 定时器 |             |
|          | `TMOD.2 | C/T = 1` -> 计数器 | `P3.4 / T0` |
| `Timer1` | `TMOD.6 | C/T = 0` -> 定时器 |             |
|          | `TMOD.6 | C/T = 1` -> 计数器 | `P3.5 / T1` |

**2.3、分频模式选择：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Timer09.png" alt="image-20250915165414427" style="zoom: 67%;" />

假设**芯片时钟是`12 MHz`**进行**12分频**就是`1 MHz`（<span style="color:red">`1MHz=1000kHz，1kHz=1000Hz`，每秒钟计数`100`万次</span>），<u>每隔<span style="color:red">**1 us**</span>就要**记1次数**</u>。

`Timer0`的速率，在STC-ISP编程器中设置：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Timer10.png" alt="image-20250915165115906" style="zoom: 67%;" />



## 3、<span style="color:brown">开关控制：</span>

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Timer11.png" alt="image-20250915171154208" style="zoom:50%;" />

`GATE、INT0、TR0`一起作为**定时器开关的控制寄存器**：

| GATE | INT0 | TR0  | 定时器状态 |
| ---- | ---- | ---- | ---------- |
| 0    | /    | 1    | 使能       |
| /    | 1    | 1    | 使能       |



## 4、<span style="color:brown">预装载值：</span>

**4.1、时基单元：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/Timer12.png" alt="image-20250915171720205" style="zoom: 67%;" />

计数器里有**两个时基单元**：**TL0（低8位）**和 **TH0（高8位）**总共**16位**，所以叫**16位定时/计数器**。

`TL0`的**8位溢出向`TH0`进位**，`TH0`计数**溢出置位TCON中**，即：<span style="color:blue">溢出标志位`TF0`</span>。

**4.2、数值计算：**

它<u>最多可以计数 **`2^16 = 65535`次**</u>，也就是**定时器增加到`65536`时，会触发一次溢出。**

**`STC89C52RC/RD+`单片机系统时钟**是`11.0592 MHz`时，在**12T模式**：

- 定时器频率：`11.0592 MHz /12 = 921600 Hz`；
- `1 s`计数**`921600`次**：`10 ms`计数`9216`次；



## 5、<span style="color:brown">溢出中断：</span>

**5.1、初始化中断：**

对照《中断系统结构》和《中断寄存器》，针对Timer0，需要配置`TCON.5 / TF0`、`IE.1 / ET0`：

- `ET0`置为`1`，允许`Timer0`中断，相反则禁止`Timer0`中断；
- `TF0`由硬件配置；

**5.2、LED闪烁：**

```c
#include <reg52.h>
// 设置溢出时间10ms
#define TIME_OUT (65536 - 9216)
int count = 0;
sbit LED2 = P2 ^ 6;
/*中断函数*/
void time0() interrupt 1{
    count++;
	if(count >= 100) { // 间隔1s闪烁
		LED2 = ~LED2; 
        count = 0;
	}
	// 没触发一次, 重新装在预装载值
	TL0 = TIME_OUT;
	TH0 = TIME_OUT >> 8;
}
void main() {
	/*初始化Timer0*/
	// 设置Timer0工作模式为模式1（M1、M0分别为0、1）
	// 设置Timer0时钟源, TCON.2|C/T为0（系统时钟）, 并作为定时器
	// 设置GATE为0
	TMOD = 0x01; // 0000 0001B
	// TCON.3 / GATE = 0, TR0 = 1, 按照与门逻辑, 打开定时器开关
	TR0  = 1;
	// 设置预装载值
	// 10ms触发一次
	// 56320 -> 1101 1100 0000 0000
	TL0 = TIME_OUT; // 0000 0000B
	TH0 = TIME_OUT >> 8; // 1101 1100B
    
	/*初始化Timer0中断*/
	// TF0由硬件设置, ET0置为1, 允许Timer0中断
	ET0 = 1;
	// 打开使能总开关
	EA  = 1;
    
	// CPU核心任务
	while(1){}; 
}
```

可更换为：LED流水灯、<u>机械按键控制LED、触控按键控制LED（存在抖动问题）</u>。
