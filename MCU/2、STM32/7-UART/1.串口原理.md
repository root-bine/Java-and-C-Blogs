## 1、<span style="color:brown">串口介绍：</span>

**1.1、串口电平标准：**

|    Type     |        HIGH_LEVEL        |        LOW_LEVEL         |
| :---------: | :----------------------: | :----------------------: |
|  `TTL`电平  | `+3.3 V / +5 V`，表示`1` |      `0 V`，表示`0`      |
| `RS232`电平 | `[-3 V, -15 V]`，表示`1` | `[+3 V, +15 V]`，表示`0` |
| `RS485`电平 | `[+2 V, +6 V]`，表示`1`  | `[-2 V, -6 V]`，表示`0`  |

**1.2、UART与USART：**

> STM32F10xxx参考手册_ch.pdf：2.1 系统架构 -> 图1 系统结构

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART01.png" alt="image-20251121171922167" style="zoom: 40%;" />

`STM32F103RC`系列芯片中，有**五个**串口：`3`个`USART` (通用**同步和异步**收发器)、`2`个`UART` (通用**异步**收发器)。

**1.3、IO说明：**

查看`STM32F103RC`芯片手册：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART02.png" alt="image-20251121172342324" style="zoom: 67%;" />

☑️**数据发送线路**：

| `TX`：发送数据`Output`引脚 | `RX`：接收数据`Input`引脚 | `SCLK`：发送器时钟`Output`引脚（仅适用于<span style="color:red">同步模式</span>） |
| :------------------------: | :-----------------------: | :----------------------------------------------------------: |

☑️**硬件流控**：如果<span style="color:red">发送设备发送太快，接收设备来不及处理</span>，可以通过**流控**来<u>控制传输的速度</u> 

| `nRTS (Request To Send)`：请求发送`Output`引脚 | 表示`MCU`自身<u>是否`Ready to Receive`</u> |
| :--------------------------------------------: | :----------------------------------------: |

| `nCTS (Clear To Send)`：清除发送`Input`引脚 | 表示`MCU`用于<u>接收对方的`nRTS`信号</u> |
| :-----------------------------------------: | :--------------------------------------: |



## 2、<span style="color:brown">串口说明：</span>

**2.1、数据帧格式：**

- 起始位`(1 bit)`、终止位`(1 bit)`；
- 数据位`(8 bit)`、校验位`(1 bit)`组成；

<u>每段数据帧结束</u>都有一个空闲位`(1 / 2 bit)`，且<span style="color:red">数据发送按照`LSB-First`收发</span>：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART03.png" alt="image-20251121181730713" style="zoom:60%;" />

**2.2、波特率：**

| 特点             | 波特率越高，传输速度越快                                     |
| ---------------- | ------------------------------------------------------------ |
| **`Baud`值**     | `300 / 1200 / 2400 / 9600 / 19200 / 38400 / 115200 / 230400`等 |
| **串口通信速率** | 单位时间内，传输二进制的位数                                 |
|                  | 波特率`9600`，指`1 s`内传输`9600 bit`，则**传输一位**需要`1/9600 = 104.17 us` |

**2.3、串口模式：**

|             ✅Mode              |   Description    |
| :----------------------------: | :--------------: |
|         `Asynchronous`         |     异步通讯     |
|         `Synchronous`          |     同步通讯     |
|  `Single Wire (Half-Duplex)`   | 单线(半双工)通讯 |
| `Multiprocessor Communication` |   多处理器通信   |

|            ☑️Mode            |                         Description                          |
| :-------------------------: | :----------------------------------------------------------: |
| `SmartCard`、`IrDA` 、`LIN` | 通信协议，应用于**智能卡(IC 卡 / 银行卡)**、**红外串口**、**局域网 ** |



## 3、<span style="color:brown">串口配置：</span>

**3.1、设置串口：**

在`Pinout & Configuration`，点击`Connectivity`，<u>选择`USART / UART`的类型，并配置`Mode`与`Baud Rate`</u>：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART04.png" alt="image-20251121183916180" style="zoom: 50%;" />

这样设置`UART / USART`，`Stm32CubeMX`会<span style="color:red">自动配置对应的GPIO引脚</span>：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_UART05.png" alt="image-20251121184022087" style="zoom:50%;" />

**3.2、数据传输函数：**

> stm32f1xx_hal_uart.h，可在HAL库文档查询

|         Function          |             Description              |
| :-----------------------: | :----------------------------------: |
|   `HAL_UART_Transmit()`   | 串口轮询模式发送（使用超时管理机制） |
|   `HAL_UART_Receive()`    | 串口轮询模式接收（使用超时管理机制） |
| `HAL_UART_Transmit_IT()`  |           串口中断模式发送           |
|  `HAL_UART_Receive_IT()`  |           串口中断模式接收           |
| `HAL_UART_Transmit_DMA()` |          串口`DMA`模式发送✅          |
| `HAL_UART_Receive_DMA()`  |          串口`DMA`模式接收✅          |

**3.3、中断函数：**

> stm32f1xx_hal_uart.h，可在HAL库文档查询

|            Function             | 通过中断处理函数调用 |
| :-----------------------------: | :------------------: |
| `HAL_UART_TxHalfCpltCallback()` |       发送过半       |
|   `HAL_UART_TxCpltCallback()`   |       发送完毕       |
| `HAL_UART_RxHalfCpltCallback()` |       接收过半       |
|   `HAL_UART_RxCpltCallback()`   |       接收完毕       |
|   `HAL_UART_ErrorCallback()`    |  传输过程中出现错误  |