```c
#include <reg52.h>
// ================= 预装载值: 10 ms =================
#define TIMS (65536-9216 )
// ================= 配置定义Register =================
sfr P4    = 0xe8;                   
sfr XICON = 0xc0;                   
sbit PX3  = XICON^7;
sbit EX3  = XICON^6;
sbit IE3  = XICON^5;
sbit IT3  = XICON^4;
sbit PX2  = XICON^3;
sbit EX2  = XICON^2;
sbit IE2  = XICON^1;
sbit IT2  = XICON^0;
sbit INT2 = P4^3;
sbit key1 = P4^3;
sbit led1 = P2^7;
sbit ds_pin = P0^3;
sbit stcp_pin = P0^4;
sbit shcp_pin = P0^5;
// ================= 定义参数 =================
unsigned char num[]={0x3F,0x06,0x5B,0x4F,0x66,0x6D,0x7D,0x07,0x7F,0x6F};
int count = 0;
static unsigned int flag = 0;
// ================= 实现数码管功能 =================
void hc595_send_byte(unsigned char byte) {
	unsigned int i;
    for(i = 0; i < 8; i++) {
        if(byte & 0x80) {
            ds_pin = 1;
        } else {
            ds_pin = 0;
        }
        shcp_pin = 0;
        shcp_pin = 1;
        byte <<= 1;
    }
}
void hc595_send_data(unsigned char num, unsigned char addr) {
	hc595_send_byte(num);
	if(addr == 0) {
        hc595_send_byte(0xFE);
    } else if(addr == 1) {
        hc595_send_byte(0xFD);
    }  
    stcp_pin = 0;
    stcp_pin = 1;
}
// ================= 延时函数 =================
void delay_ms(unsigned int xms); // 调试时, 需补充完整
// ================= 中断服务函数 =================
void timer0() interrupt 1 {
	if(count < 9900) {		
		count ++;
	}
	TL0 = TIMS;
	TH0 = TIMS >> 8;
}
void exit2() interrupt 6 {
	if(key1 == 0) {
		if(flag == 0) {
            count = 0;
			TR0 = 1;
			TL0 = TIMS;
			TH0 = TIMS >> 8;
        } else {
			TR0 = 0;
        }
        flag = ~flag;
     	delay_ms(10);
  }
}
// ================= 初始化INT2、Timer0 =================
void init_int2() {
	IT2 = 1;
  	EX2 = 1;
}
void init_timer0() {
	TMOD = 0x01;
	TR0 = 1;
	TL0 = TIMS; 
	TH0 = TIMS >> 8;
	ET0 = 1;
}
// ================= main函数 =================
void main(){
    init_int2();
	init_timer0(); 
	EA = 1;
	while(1) {
		hc595_send_data(num[count/1000], 0);
		hc595_send_data(num[(count/100)%10], 1);
	}
}

```

