## 1、<span style="color:brown">接收流程：</span>

**1、接收结构图：**

> 模式1

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/UART21.png" alt="image-20251010130211582" style="zoom:50%;" />

**1.2、软件操作分析：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/UART22.png" alt="image-20251010130300961" style="zoom:67%;" />



## 2、<span style="color:brown">接收配置：</span>

> 与发送数据流程类似，区别在于需要**配置REN** 

**2.1、模式与REN：**

根据`UART`需要的工作模式：**模式1**，配置`SCON.7 / SM0 = 0`、`SCON.6 / SM1 = 1`，或者`SCON = 0x40`。

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/UART23.png" alt="image-20251010133153725" style="zoom:67%;" />

```c
SM0 = 0;
SM1 = 1;
REN = 1;
或者
SCON = 0x50;
```

**2.2、波特率配置：**

根据《**常用波特率与定时器/计数器1各参数关系**》，<u>**模式1** + 波特率为`9600`</u>：

| PCON.7 / SMOD = 0 | TMOD.6 / C/T = 0 | Mode2：8 bit auto load | 预装载值 = 0xFD |
| ----------------- | ---------------- | ---------------------- | --------------- |

`Timer1`配置：

```c
TMOD &= 0x0F;  //清空TMOD中定时器1相关
TMOD |= 0X20;  //设置定时器1工作模式2 8位自动重载，这里为什么使用|=而不使用=呢，为了避免清除定时器0配置
TH1 = 0xFD;    //设定初值
TL1 = 0XFD;    //设定装载值 
TR1 = 1;       //打开计数器
```

`PCON`配置：

```c
PCON |= 0X00;  //设置B7为0
```

`PCON` 的 `SMOD` 位控制波特率倍速（置1为两倍波特率），<span style="color:red">不加倍则不需要设置</span>。

**2.3、校验位：**

在**模式2、模式3**作为**校验位**。**模式0**和**模式1**的<u>数据部分</u>是`8 bit`的，<span style="color:red">**无需校验位**</span>。



## 3、<span style="color:brown">UART接收数据：</span>

```c
#include <reg52.h>
sbit led=P2^7;
void UartInit() {             //9600bps@11.0592MHz
      SCON = 0x50;            //0101 0000 串口工作模式1 允许接收
      TMOD &= 0x0F;           //清空TMOD中定时器1相关
      TMOD |= 0X20;           //设置定时器1工作模式2:8位自动重载
      TH1 = 0xFD;             //设定定时初值
      TL1 = 0XFD;
      TR1 = 1;                //启动定时器1
}
void Receive() {
    char receive;//用于接收串口数据的变量
    if(RI==1) { //RI=1说明串口接收到了数据
           RI=0;   //RI置0保证下次接收
           receive=SBUF;//将从串口接收到的数据报存到变量中
           //判断接收的数据，作出相应的操作
           if(receive=='O')
               led=0;
           else if(receive=='C')
               led=1;        
        }
}
void main() {
    UartInit();
    while(1) {
        Receive();
    }
}
```
