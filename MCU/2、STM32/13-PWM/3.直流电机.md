## 1、<span style="color:brown">TC118S：</span>

**1.1、引脚说明：**

`TC118S`（**单通道直流马达驱动器**）：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/PWM05.png" alt="image-20251012150011203" style="zoom: 45%;" />

**单片机**起到的主要作用是<span style="color:red">**控制**</span>，而**直流电机**是<u>*大功率的器件，不能使用单片机直接驱动*</u>。

**1.2、输入/输出逻辑表：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_Motor02.png" alt="image-20251204180128958" style="zoom: 25%;" />

**1.3、原理图：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/STM32_Motor01.png" alt="image-20251204175843256" style="zoom:45%;" />

`GPIO`说明：`DC_AN1`连接`PB14`、`DC_AN2`连接`PB15`。

✅`TIM1_CH3N`与`TIM1_CH3`为**互补输出**，因此<span style="color:red">启动定时器必须**开启主通道** + **互补通道**</span>。



## 2、<span style="color:brown">功能实现：</span>

**2.1、控制方向：**

配置**GPIO引脚**：`PB14`、P`B15`，开启串口打印

````c
while (1) {
		HAL_GPIO_WritePin(DC_AN1_GPIO_Port, DC_AN1_Pin, GPIO_PIN_SET);
		HAL_GPIO_WritePin(DC_AN2_GPIO_Port, DC_AN2_Pin, GPIO_PIN_RESET);
		printf("Motor, forward\n");
		HAL_Delay(1000);
		HAL_GPIO_WritePin(DC_AN1_GPIO_Port, DC_AN1_Pin, GPIO_PIN_RESET);
		HAL_GPIO_WritePin(DC_AN2_GPIO_Port, DC_AN2_Pin, GPIO_PIN_RESET);
		printf("Motor, standby status\n");
		HAL_Delay(1000);
		HAL_GPIO_WritePin(DC_AN1_GPIO_Port, DC_AN1_Pin, GPIO_PIN_RESET);
		HAL_GPIO_WritePin(DC_AN2_GPIO_Port, DC_AN2_Pin, GPIO_PIN_SET);
		printf("Motor, backward\n");
		HAL_Delay(1000);
		HAL_GPIO_WritePin(DC_AN1_GPIO_Port, DC_AN1_Pin, GPIO_PIN_SET);
		HAL_GPIO_WritePin(DC_AN2_GPIO_Port, DC_AN2_Pin, GPIO_PIN_SET);
		printf("Motor, brake\n");
		HAL_Delay(1000);
}
````

**2.2、控制速度：**

❗参考**定时器复用功能重映射**，`PB14`、P`B15`连接`TIM1`的`CH2N`、`CH3N`。

☑️<u>`TIM1`默认自动配置`GPIO`为`PB0`、`PB1`</u>，因此**需要手动设置**`PB14`、P`B15`的模式为`TIM1_CH2N`、`TIM1_CH3N`。

✅由于**TIM1属于高级定时器**，启动函数有所不同：

- 高级定时器：`HAL_TIMEx_PWMN_Start(&htim1, TIM_CHANNEL_3)`；
- 基本定时器 / 通用定时器：`HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3)`；

````c
uint16_t pwm_value = 0;   //占空比  
HAL_TIM_PWM_Start(&htim1, TIM_CHANNEL_3);   //开启PWM输出(主通道CH3)
HAL_TIMEx_PWMN_Start(&htim1,TIM_CHANNEL_3); //开启PWM输出(互补通道CH3N)
HAL_GPIO_WritePin(GPIOB,DC_AN2_Pin,GPIO_PIN_RESET); //设置DC_AN2为低, 只保持一个方向转动
while (1) {
    while (pwm_value < 150){
       pwm_value++;
       //修改比较值，修改占空比，占空比为pwm_value/500
       __HAL_TIM_SetCompare(&htim1, TIM_CHANNEL_3, pwm_value);    
       HAL_Delay(10);
    }
    HAL_Delay(1000);
    while (pwm_value){
       pwm_value--;
       __HAL_TIM_SetCompare(&htim1, TIM_CHANNEL_3, pwm_value);   
       HAL_Delay(10);
    }
    HAL_Delay(1000);
  }
}
````

