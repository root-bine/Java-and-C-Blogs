## ✅仅供学习

## 1、<span style="color:brown">Timer配置：</span>

**1.1、编码器模式：**

STM32的定时器有`Encoder Mode` (**编码器模式**)，仅<span style="color:red">高级定时器和通用定时器支持</span>。

**1.2、定时器配置：**

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/EnCoder04.png" alt="image-20251203193735189" style="zoom:50%;" />

选择`TIM3`，无需配置`Clock Source`，仅<u>在`Combined Channels`选择`Encoder Mode`</u>即可。

<u>`Timer`相关参数</u>：

| `PSC`：`0`                 `Counter`：`65535` |
| :-------------------------------------------: |

<u>`Encoder`相关参数</u>：

| `Encoder Mode`：`Encoder Mode Tl1 and TI2` | `Polarity`  :  `Rising Edge` |
| ------------------------------------------ | ---------------------------- |



## 2、<span style="color:brown">参数说明：</span>

**2.1、Econder Mode TI1 and TI2：**

**编码模式**设置为`Encoder Mode TI1 and TI2`，则会**默认检测AB相的上升沿与下降沿**：

<img src="https://raw.githubusercontent.com/root-bine/image/main/Typora-image/EnCoder05.png" alt="image-20251203194509256" style="zoom:50%;" />

`TI1`和`TI2`分别接**编码器的A相和B相**：

- 当编码器<u>正转 `(0,1,2，…,65535,0)`</u>，`Counter`会向上计数；
- 当编码器<u>反转 `(0,65535,65534，…,2,1,0)`</u>，`Counter`会向下计数；

✔️<span style="color:red">每一个**上升沿和下降沿都触发计数**，所以**每转一格计数器就会+4**</span>。

**2.2、Rising Edge：**

在检测到上升沿的时候，就触发**encoder捕获AB相的值**。

**2.3、工程代码：**

````c
HAL_TIM_Encoder_Start(&htim3,TIM_CHANNEL_1 | TIM_CHANNEL_2); //Encoder Mode开启使能

while (1) {
    int Direction = __HAL_TIM_IS_TIM_COUNTING_DOWN(&htim3);    //读取编码器转动方向
    //若需要检测编码器转了多少格，记得要/4，因为转一格是+4；
    int CaptureNumber = (short)__HAL_TIM_GET_COUNTER(&htim3)/4;  //读取编码器数据
    printf("Direction is %d \r\n",Direction);
    printf("CaptureNumber is %d \r\n",CaptureNumber);
    HAL_Delay(500);
}
````