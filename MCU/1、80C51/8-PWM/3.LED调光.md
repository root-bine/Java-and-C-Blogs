## 1、<span style="color:brown">串口调光：</span>

实验目标：通过**电脑串口下发数字0-100**，改变**LED灯的亮度**。

---

引入头文件和定义寄存器：

````c
#include <reg52.h>
sbit led = P2 ^ 7;
````

定义`UART`初始化函数、延时函数：

````c
// ================= 初始化UART =================
void UartInit() {
	SCON = 0x50;            
    TMOD &= 0x0F;           
    TMOD |= 0X20; // 模式2: 8位自动装载           
    TH1 = 0xFD;             
    TL1 = 0XFD;
    TR1 = 1;
}
// ================= 延时函数 =================
void Delayus(int t)	{
	while(t--){
		unsigned char i;
		i = 2;
		while (--i);
	}
}
````

定义参数变量：

````c
// ================= 定义参数变量 =================
//定义LED_PWM 占空比，亮灭时间
static int duty = 0;
static int high_time = 0;
static int low_time = 800;
````

编写main函数：

````c
// ================= main函数 =================
void main() {
    UartInit();
    while (1) {
        receive();
        open_led()
    }
}
````



## 2、<span style="color:brown">数据接收：</span>

````c
void receive() {
    if (RI == 1) {
		RI = 0;
    	duty = SBUF % 101;  // 限定temp范围在0 ~ 100
        // 控制high_time、low_time的范围在0 ~ 800
    	high_time = duty << 3; // 等价于: duty * 8
    	low_time = 800 - high_time;
	}
}
````

在<span style="color:red">静态LED亮度</span>调试中，可以使用**%运算**。



## 3、<span style="color:brown">LED亮灭：</span>

````c
void open_led() {
    if (high_time != 0) {
		led = 0;
		Delayus(high_time);
    } else {
		led = 1;
     	Delayus(low_time);
    }
}		
````

